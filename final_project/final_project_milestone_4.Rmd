---
---
---

**Lizzy Alspach** *JOUR472 Final Project Milestone 4* *05/04/2024*

This summer, Iâ€™ll be interning with The Baltimore Sun and covering Carroll and Howard counties. Because of how voting, demographics and other information in various counties have changed over time, I want to explore these fields and understand the counties I will soon be reporting on. I hope to use this analysis to inform my reporting this summer. The data I am using is from the U.S. Census and Maryland election website.

First, we need to install our packages.

```{r}
library(tidyverse)
library(tidycensus)
library(rvest)
library(janitor)
library(formattable)
```

Now, to answer some of my questions about Howard and Carroll county demographics, I need to grab Census data. I'll take it with my API key.

```{r}
#census key -- i removed my personal key in accordance with feedback from milestones 2 and 3
census_api_key("keyhere", install=TRUE, overwrite=TRUE)

readRenviron("~/.Renviron")
```

First, I wanted to understand the demographics of both Carroll and Howard counties and how that has changed over time. For this, I took U.S. Census Data from 2020 and 2010 to see how these populations have changed. With the rising cost of living as well, I would like to see how the diversity of these counties have changed. **Q** *How has diversity changed over time in both Howard and Carroll counties? What race of people populates each county the most?*

```{r eval=FALSE, include=FALSE}
#load in census data through my API
acs_vars <- load_variables("acs5", year = 2020)

#grab maryland section, divide by county by race for both 2010 and 2020. I want to get these both to see how diverse populations have changed over time in these counties.
x2020_md <- get_acs(geography = "county",
              variables = c(white = "B02001_002", 
                            black = "B02001_003",
                            american_ind = "B02001_004",
                            asian = "B02001_005",
                            pacif_islander = "B02001_006",
                            hispanic = "B03002_001"),
              state = "MD",
              year = 2020) 

x2010_md <- get_acs(geography = "county",
              variables = c(white = "B02001_002", 
                            black = "B02001_003",
                            american_ind = "B02001_004",
                            asian = "B02001_005",
                            pacif_islander = "B02001_006",
                            hispanic = "B03002_001"),
              state = "MD",
              year = 2010) 

```

In these two dataframes, I now have the GEOID, name, variable, estimate and margin of error. This is all in regards to racial population, and variable determines which group is being talked about -- it's divided by race, and helps me sort out the populations. GEOID is the geographical identification of the area in NAME, which is just the name of the county. I like to combine dataframes by GEOID because it's very precise and most often doesn't have any spelling errors in the data, so has an easy time to join. Estimate is just that -- the estimate of the number of people in the specific population. Margin of error is how many people could be given or taken from the estimate, just essentially the wiggle room in the data the Census has that shows where things could possibly go wrong.

Now, to join the dataframes and filter the counties out that I don't want.

```{r eval=FALSE, include=FALSE}
#now want to filter out the counties! but first, i'll join the two dataframes. as mentioned before, i like doing this through the GEOID since it's very exact, but also joined by variables so i didn't get any duplicates.
md_total <- x2020_md %>% 
  inner_join(x2010_md, by = c("GEOID", "variable")) %>% 
  rename(estimate_2020 = estimate.x, 
         estimate_2010 = estimate.y,
         name = "NAME.x") %>%
  select(GEOID, name, variable, estimate_2020, estimate_2010)

#filter out other counties and mutate for pct_change and pct_whole, then i just am going to separate by county too! pct_change will evaluate how the percentage of that population has changed, while pct_whole values will tell me how each race has made up the total population in different years. i mutated a sum of the estimate to be able to calculate it!
demo_howard <- md_total %>% 
  filter(name == "Howard County, Maryland") %>% 
  mutate(pct_change = (((estimate_2020-estimate_2010)/estimate_2010)*100)) %>%
  mutate(all_2020 = sum(estimate_2020)) %>% 
  mutate(all_2010 = sum(estimate_2010)) %>% 
  mutate(pct_whole_20 = percent(estimate_2020/all_2020)) %>% 
  mutate(pct_whole_10 = percent(estimate_2010/all_2010))

demo_carroll <- md_total %>% 
  filter(name == "Carroll County, Maryland") %>% 
  mutate(pct_change = (((estimate_2020-estimate_2010)/estimate_2010)*100)) %>% 
  mutate(all_2020 = sum(estimate_2020)) %>% 
  mutate(all_2010 = sum(estimate_2010)) %>% 
  mutate(pct_whole_20 = percent(estimate_2020/all_2020)) %>% 
  mutate(pct_whole_10 = percent(estimate_2010/all_2010))

#now want to view both of my dataframes -- i liked having two separate ones since it was easier to read for me.
view(demo_carroll)

view(demo_howard)

#based on this information, it appears that both Howard County and Carroll County have become more diverse. 

#In Howard County, the white population decreased from about 33% in 2010 to about 28% of the whole population in 2020. The Howard County Black population increased by almost 1%, the Asian population by nearly 3% and an almost 1% increase in Hispanic population out of the entire Howard County population. 

#In Carroll County, the white population decreased from an about 47% of the whole population to about 46%. There wasn't too much increase in other races -- there was an about 1% increase in the Asian population of the whole and a less than 1% increase in the percentage of the whole population for all other races. 
```

Now that we've grabbed this information for Howard and Carroll counties, I want to understand how this compares to the demographic breakdown in Maryland and how that has changed. So now, let's do the same thing we did above for the entire state of Maryland.

```{r eval=FALSE, include=FALSE}
acs_vars <- load_variables("acs5", year = 2020)

#maryland 2020 and maryland 2010 demographics -- i can pull from the same parts of the Census API since I'm just choosing a different geographical region, such as state instead of county. 
x2020_state <- get_acs(geography = "state",
              variables = c(white = "B02001_002", 
                            black = "B02001_003",
                            american_ind = "B02001_004",
                            asian = "B02001_005",
                            pacif_islander = "B02001_006",
                            hispanic = "B03002_001"),
              state = "MD",
              year = 2020) 

x2010_state <- get_acs(geography = "state",
              variables = c(white = "B02001_002", 
                            black = "B02001_003",
                            american_ind = "B02001_004",
                            asian = "B02001_005",
                            pacif_islander = "B02001_006",
                            hispanic = "B03002_001"),
              state = "MD",
              year = 2010) 
```

The values I have in these dataframes are the same -- GEOID, name, variable, estimate and margin of error. Since I'm pulling from the same place, these also have the same meanings, as described above.

Let's join the 2020 and 2010 dataframes to compare the two census information bits as above.

```{r}
#joining dataframes, mutating to make new columns -- going to make pct_change to see how population has overall changed, look at pct_total to see how the total demographic breakdown has also changed as a percent of the whole population. i also made a sum column so i could calculate pct_whole.
state_total <- x2020_state %>% 
  inner_join(x2010_state, by = c("GEOID", "variable")) %>% 
  rename(estimate_2020 = estimate.x, 
         estimate_2010 = estimate.y,
         name = "NAME.x") %>%
  mutate(pct_change = (percent((estimate_2020-estimate_2010)/estimate_2010))) %>% 
  mutate(total_2010 = sum(estimate_2010)) %>% 
  mutate(total_2020 = sum(estimate_2020)) %>% 
  mutate(pct_total_2020 = percent(estimate_2020/total_2020)) %>% 
  mutate(pct_total_2010 = percent(estimate_2010/total_2010)) %>% 
  select(GEOID, name, variable, estimate_2020, total_2020,pct_total_2020,estimate_2010,total_2010,pct_total_2010,pct_change)

#The white population in Maryland out of a percentage of the whole changed from about 30% in 2010 to about 28% in 2020. The Hispanic population out of whole from 2010 to 2020 increased by about 1%, but the rest of the races in Maryland changed by less than 1% of the percentage of the whole. These changes are similar to how it is in Howard and Carroll counties, with the white populations slightly decreasing -- Maryland, Howard County and Carroll County all are predominantly white as well. 

```

I also wanted to see how voting trends have changed in Carroll County. **Q** *How does Carroll County lean in voting Republican vs. Democratic? Has this changed in the past few election cycles?*

To answer this question, I am scraping a website (<https://elections.maryland.gov>) for each election year in Carroll County and the entire state of Maryland. In it, there are quite a few variables -- name, party, early voting, election day, absentee/provisional, total and percentage. Name is the title of the president and vice president running for office, and party is the party affiliation of the candidate. Each other column breaks down the number of people that voted in a variety of ways, including absentee, mail-in, early voting or on election day. The total column just totals all of the people who voted for that candidate, and the percent column describes what percentage of the whole voted for that particular candidate. As shown later down, I ended up doing a lot of cleaning on Carroll County's information to ensure the columns were how I wanted them to be named.

```{r}
#read in the html and extract all the tables
x20_results <- "https://elections.maryland.gov/elections/2020/results/general/gen_results_2020_4_by_county_07-1.html" %>%
  read_html() %>%
  html_table()

x20_results <- x20_results[[2]]

x16_results <- "https://elections.maryland.gov/elections/2016/results/general/gen_results_2016_4_by_county_07-1.html" %>%   read_html() %>%
  html_table()

x16_results <- x16_results[[1]]

x12_results <- "https://elections.maryland.gov/elections/2012/results/general/gen_results_2012_4_by_county_07-1.html" %>%
  read_html() %>% 
  html_table()

x12_results <- x12_results[[1]]
```

Now, I'm going to clean my dataframes.

```{r}
#had to do a bit more cleaning on this table -- for some reason, it recognized information above the table as an actual table, and i had to do a lot more cleaning to ensure numbers were recognized by the program. 
x20_results_clean <- x20_results %>%
  mutate(
    Early_Voting = as.numeric(gsub("[^0-9.]", "", `Early Voting`)),  # Remove non-numeric characters and convert to numeric
    Election_Day = as.numeric(gsub("[^0-9.]", "", `Election Day`)),
    By_Mail = as.numeric(gsub("[^0-9.]", "", `By Mail`)),
    Total = as.numeric(gsub("[^0-9.]", "", Total)),
    Percent = as.numeric(gsub("[^0-9.]", "", Percent))
  ) %>%
  clean_names()

x16_results_clean <- x16_results %>%
  mutate(
    Early_Voting = as.numeric(gsub("[^0-9.]", "", `Early Voting`)), 
    Election_Day = as.numeric(gsub("[^0-9.]", "", `Election Day`)),
    Absentee_Provisional = as.numeric(gsub("[^0-9.]", "", `Absentee / Provisional`)),
    Total = as.numeric(gsub("[^0-9.]", "", Total)),
    Percentage = as.numeric(gsub("[^0-9.]", "", Percentage))
  ) %>%
  clean_names()

x12_results_clean <- x12_results %>%
  mutate(
    Early_Voting = as.numeric(gsub("[^0-9.]", "", `Early Voting`)),
    Election_Day = as.numeric(gsub("[^0-9.]", "", `Election Day`)),
    Absentee_Provisional = as.numeric(gsub("[^0-9.]", "", `Absentee / Provisional`)),
    Total = as.numeric(gsub("[^0-9.]", "", Total)),
    Percentage = as.numeric(gsub("[^0-9.]", "", Percentage))
  ) %>%
  clean_names()
```

Now, let's analyze the data we've now cleaned to find how Carroll County has leaned in since the 2012 election.

```{r}
x20_gen_results <- x20_results_clean %>% 
  select(name, party, early_voting_2, election_day_2,by_mail_2,total,percent) %>% 
  rename(early_voting = "early_voting_2",
         election_day = "election_day_2",
         by_mail = "by_mail_2")

x16_gen_results <- x16_results_clean %>% 
  select(name, party, early_voting_2, election_day_2,absentee_provisional_2,total,percentage) %>% 
  rename(early_voting = "early_voting_2",
         election_day = "election_day_2",
         absentee_provisional = "absentee_provisional_2",
         percent = "percentage")

x12_gen_results <- x12_results_clean %>% 
  select(name, party, early_voting_2, election_day_2, absentee_provisional_2, total, percentage) %>% 
  rename(early_voting = "early_voting_2",
         election_day = "election_day_2",
         absentee_provisional = "absentee_provisional_2",
         percent = "percentage")

#Based on this analysis with percentage, it appears that Carroll County has always skewed Republican in general elections since 2012. Interestingly enough, less of the voting population seems to have voted for the Republican candidates as the years have gone on. From a 64.8% percent voting for Romney to 63.4% for Trump in 2016 and a later 60% for Trump in 2020, support for Republican candidates has actually slightly waned. Can this be attributed to less people showing up to the polls, or some other reason? As I work in Carroll County, I'll use this analysis to inform my reporting.
```

I also want to compare this to generally how the entire state of Maryland has leaned in general elections. Does the trend of Carroll County lean in the same way as the entire state?

I scraped the same website to answer this question and the variables are the same -- name, party, early voting, election day, by mail/absentee/provisional, total and percent. The numbers aren't the same but count the same things.

```{r}
#pull in data from the state elections
x12_result_md <- "https://elections.maryland.gov/elections/2012/results/general/gen_results_2012_4_001-.html" %>%
  read_html() %>%
  html_table()

x12_result_md <- x12_result_md[[1]]

x16_result_md <- "https://elections.maryland.gov/elections/2016/results/general/gen_results_2016_4_001-.html" %>% 
  read_html() %>% 
  html_table()

x16_result_md <- x16_result_md[[1]]

x20_result_md <- "https://elections.maryland.gov/elections/2020/results/general/gen_results_2020_4_001-.html" %>% 
  read_html() %>% 
  html_table()

x20_result_md <- x20_result_md[[2]]
```

Now, let's see how Marylanders voted in the past three elections.

```{r}
head(x12_result_md)

head(x16_result_md)

head(x20_result_md)

#Based on these results, it appears that Carroll County is a bit of an outlier in favor of Republican candidates. The percentage of voters in the state, however, seemed to have changed in regards to party support -- there was about 62% of votes for Obama and Biden in 2012, but in 2016, that support for democrats fell by about 2%. In 2020, it grew again to be 65.4% of voters in favor of the Democratic candidate. It appears that support for Republicans grew in 2016, but then fell once again in 2020. 
```

Now, to make a graphic on these trends. The numbers are nice, but I'm not sure I can understand what I'm reporting on until I see the data in a graphic format.

**Graphic on Carroll County votes in general elections**

Embed code:

```{r, results='asis'}
cat('<iframe src="<div class="flourish-embed flourish-chart" data-src="visualisation/17783968"><script src="https://public.flourish.studio/resources/embed.js"></script></div>"></iframe>')
```

Online link:

<https://public.flourish.studio/visualisation/17783968/>

Lastly, I wanted to explore how the household median income changed in Carroll County and Howard County. I'll be using data from the U.S. Census. Similar to my first question, the data is grabbed using my census API and pulled from the data that the census has. **Q** *How has the median household income changed in Carroll County and Howard County?*

```{r}
#grab the data by county for median income
x20_md_median_income <- get_acs(geography = "county",
              variables = c(median_income = "B06011_001"),
              state = "MD",
              year = 2020) 

x10_md_median_income <- get_acs(geography = "county",
              variables = c(median_income = "B06011_001"),
              state = "MD",
              year = 2010)
```

Now, to join and filter the dataframes.

```{r}
#clean the data! I want to filter out for the specific counties I want and do some cleanign to get all that I want.
md_median_income_total <- x20_md_median_income %>% 
  inner_join(x10_md_median_income, by="GEOID", "variable") %>% 
  rename(name = "NAME.x",
         x20_estimate = "estimate.x",
         x10_estimate = "estimate.y",
         variable = "variable.x")
```

Lastly, I'm going to use my newly combined dataframes to find the median income for each county.

```{r}
howard_med_income <- md_median_income_total %>% 
  filter(name == "Howard County, Maryland") %>% 
  select(name, x20_estimate, x10_estimate, variable) %>% 
  mutate(pct_change = (((x20_estimate - x10_estimate)/x10_estimate)*100)) %>%
  arrange(desc(pct_change))

carroll_med_income <- md_median_income_total %>% 
  filter(name == "Carroll County, Maryland") %>% 
  select(name, x20_estimate, x10_estimate, variable) %>% 
  mutate(pct_change = (((x20_estimate - x10_estimate)/x10_estimate)*100)) %>%
  arrange(desc(pct_change))

#The household median income in Carroll County increased by about 20%, according to Census Data. Howard also experienced an increase in household median income by about 15%. 
```

I also want to compare this to trends in the state to see if Carroll and Howard counties follow state trends with a rising median income.

```{r}
#pull census data
x20_state_median_income <- get_acs(geography = "state",
              variables = c(median_income = "B06011_001"),
              state = "MD",
              year = 2020) 

x10_state_median_income <- get_acs(geography = "state",
              variables = c(median_income = "B06011_001"),
              state = "MD",
              year = 2010)
```

Time to join the years and also mutate some percentage change formulas.

```{r}
state_med_income <- x20_state_median_income %>% 
  inner_join(x10_state_median_income, by = c("GEOID", "variable")) %>% 
  rename(estimate_2020 = estimate.x, 
         estimate_2010 = estimate.y,
         name = "NAME.x") %>%
  mutate(pct_change = (percent((estimate_2020-estimate_2010)/estimate_2010))) %>% 
  select(GEOID, name, variable, estimate_2020, estimate_2010,pct_change)

#The household median income has increased by about 20%, which is a similar trend to that in Howard and Carroll Counties.
```

I also wanted to find how the Key Bridge collapse affected Carroll County communities. However, this data is not yet available because of how recent the collapse is. With this, I decided to instead find how many employees in Carroll are manufacturers or farmers, who would be most affected by the collapse.

**NOTE** In this question, I've been having a lot of issues trying to upload my data. Because of how the original dataframe I chose is formatted, there are groups and then subgroups and then occupations each separated. Some of these values repeat based on the occupation within each group, and there's not a clean way of reformatting the dataframe without misconstruing the data points or creating my own csv file. Because of this, I turned to the U.S. Census. Unfortunately though, the data I found was in a txt file and too large to import on its own. I will continue to try to load the data in the next steps of my project.

**Q** *What areas of work do people in Carroll County work in the most, and how have their earnings changed over time? What amount of jobs in Carroll and Howard county are similar to those of people that worked on the Key Bridge? As I watch the effects of the Key Bridge collapse, I will continue to question whether these people's incomes could be affected by the bridge collapse.*

```{r}
#https://datausa.io/profile/geo/carroll-county-md?growthOccupations=growth&measureOccupations=workforce where I grabbed my new data from. a lot of this is also aligned with census data

#Pulling up the dataframe
employment_carroll <- read.csv("Occupations.csv") %>% 
  clean_names()
```

This data seems a bit confusing at first, but it essentially has variables that break down each business into groups. Then, each group has a subsection by industry. A lot of this information repeats because there are multiple industries in each business, and then multiple types of occupations within each industry. It also has columns for workplace growth, geography, median earnings, year and margins of error for each countable variable.

Now, I'm going to arrange this data based on the workforce growth column. This will tell me which workforce section has grown the most in Carroll County.

```{r}
employment_carroll %>% 
  select(group,subgroup,occupation,year,median_earnings,workforce_growth) %>% 
  arrange(desc(workforce_growth))

#Computer Science grouped jobs grew the most in 2020, according to this analysis.
```

#Issues with this data: I tried using the other .txt files with janitor reading, but based on the data key, it wasn't entirely what I was looking for. I went back to this data that I found originally and added a link to where I grabbed the data from. I'm having a hard time isolating manufacturing jobs and other occupations in this data, so I have more questions to ask during office hours and class on Tuesday. I did most of the other cleaning and things for the rest of the questions, I just ran out of time because of the personal issues that came up this weekend and other sourcing concerns to address at The Diamondback.

**Memo** So far, I've found that both Howard and Carroll County have had an increase in estimated median income by at least 10% each. Also, I found that the white population in both counties have slightly decreased, while the population of people of other races have all increased in a greater percentage. For instance, in Howard County, the white population decreased from about 33% in 2010 to about 28% of the whole population in 2020. The Howard County Black population increased by almost 1%, the Asian population by nearly 3% and an almost 1% increase in Hispanic population out of the entire Howard County population. In Carroll County, the white population decreased from an about 47% of the whole population to about 46%. There wasn't too much increase in other races -- there was an about 1% increase in the Asian population of the whole and a less than 1% increase in the percentage of the whole population for all other races. Lastly, I've also been able to find that support for Republican party candidates in general elections based on voting data has actually slightly decreased. In Carroll County, Republican support waned from a 64.8% percent voting for Romney to 63.4% for Trump in 2016 and a later 60% for Trump in 2020. At least four percent of voters from 2012 to 2020 have stopped voting for Republican party candidates, and their support instead went toward Democratic candidates. Maryland, on the other hand, has always voted a majority Democratic. Support waned by about 2-3% for Democratic candidates in 2016, but went right back up in 2020.

#Fixes In my previous draft, I was asked to fix/add the following: - Be more specific about the demographic and voting data findings I used in my memo. - Use rio:::import to import the text files I'm looking for. - Detail about who gained at the expense of Republicans in Carroll County. - Add a link to the data I was having an issue with. - Compare my questions to state information.

I have successfully compared all of my findings at the county level with state findings, and also added more detail and specifics to my memo and summary findings. I added a link to the data I was having trouble with and also explained where all of my data came from, as well as what each variable means. As for the .txt files, I kept having issues committing them to my GitHub because I kept getting an alert that the files were too large to commit. My GitHub shut down at one point and I deleted the files in order to continue committing the rest of my changes. I am going to continue adding for the workforce question, since that is the only question I have left unanswered. I have encountered personal issues, GitHub issues and issues at The Diamondback and have added as much as I can back, but will continue to work on this and correct errors.
